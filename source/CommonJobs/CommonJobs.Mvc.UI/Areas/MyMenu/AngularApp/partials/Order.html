<!--
@using CommonJobs.Infrastructure.Mvc.SecurityTrimming
@{
    ViewBag.Title = "Pedido del día · CommonJobs";   
    ScriptManager.RegisterJs(Url.Content("~/Scripts/my-menu-order-page.js"));
}
-->
<div class="container">
    <h4>{{orderDate.format('dddd, D [de] MMMM YYYY')}}</h4>

    <div class="alert alert-error alert-block" ng-show="isOrdered">
        <div class="row">
            <form method="post" action="/MyMenu/GenerateOrder">
                <div class="span3">
                    <strong>Pedido ya realizado.</strong>
                </div>
                <div class="pull-right" ng-show="hasGenerateOrderPermission">
                    <!-- TODO: href="#" --> 
                    <a ng-click="toggleProcessButton()" style="color: #B94A48;">
                        <small>En casos excepcionales, es posible volver generar el pedido teniendo en cuenta los últimos cambios<span ng-hide="isProcessButtonVisible">...</span></small>
                    </a> 
                    <input type="submit" class="btn btn-danger btn-mini" style="font-size: 85%;" value="¡Generar ahora!" ng-show="isProcessButtonVisible" />
                </div>
            </form>
        </div>
    </div>
    <div class="alert alert-success alert-block" ng-hide="isOrdered">
        <div class="row">
            <form method="post" action="/MyMenu/GenerateOrder">
                <div class="span3">
                    <strong>Pedido aún no realizado.</strong>
                </div>
                <span class="pull-right" ng-show="hasGenerateOrderPermission">
                    <!-- TODO: href="#" --> 
                    <a ng-click="toggleProcessButton()" style="color: #468847;">
                        <small>En casos excepcionales, es posible generar el pedido antes de la generación automática<span ng-hide="isProcessButtonVisible">...</span></small>
                    </a> 
                    <input type="submit" class="btn btn-danger btn-mini" style="font-size: 85%;" value="¡Generar ahora!" ng-show="isProcessButtonVisible" />
                </span>
            </form>
        </div>
    </div>

    <ul class="nav nav-tabs" id="myTab">
        <li class="active"><a href="#/Order" data-toggle="tab">Pedido completo</a></li>
        <li ng-repeat="place in placeSummaries">
            <a data-toggle="tab" ng-href="#/Order/{{place.placeKey}}">{{place.placeName}}</a>
        </li>
    </ul>

    <div class="tab-content" style="overflow: inherit">
        <div class="tab-pane active" id="#/Order">
            <h4>Pedido completo</h4>
            <table class="table table-striped table-bordered table-hover table-condensed">
                <thead>
                    <tr>
                        <th>Lugar</th>
                        <th>Menú</th>
                        <th>Comida</th>
                        <th>Cantidad</th>
                    </tr>
                </thead>
                <!-- TODO: do not repeat tbody -->
                <tbody ng-repeat="place in placeSummaries">
                    <!-- ko if: quantity -->
                    <tr ng-repeat="option in place.optionSummaries">
                        <td>{{place.placeName}}</td>
                        <td>{{option.optionName}}</td>
                        <td>{{option.food}}</td>
                        <td>{{option.quantity}}</td>
                    </tr>
                    <!-- /ko -->
                </tbody>
            </table>
            <hr />
            <table class="table table-striped table-bordered table-hover table-condensed table-detail">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Lugar</th>
                        <th>Menú</th>
                        <th>Comida</th>
                        <th>Comentario</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: detail">
                    <tr>
                        <td>
                            <!--
                            @using (var helper = Html.GetSecurityTrimmingHelper("Edit"))
                            {
                                if (helper.HasPermission) {
                                    <a data-bind="text: employeeName, attr: { href: url, title: 'Editar menú de ' + employeeName }"></a>
                                } else {
                                    <span data-bind="text: employeeName"></span>
                                }
                            }
                            -->
                        </td>
                        <td data-bind="text: placeName"></td>
                        <td data-bind="text: optionName"></td>
                        <td data-bind="text: food"></td>
                        <td data-bind="text: comment"></td>
                    </tr>
                </tbody>
                <tfoot data-bind="foreach: placeSummaries">
                    <tr>
                        <td colspan="5">
                            <strong data-bind="text: placeName"></strong> <span data-bind="text: $root.orderDate.format('dddd, D [de] MMMM YYYY')"></span>:
                            <!-- ko foreach: optionSummaries -->
                            <!-- ko if: quantity -->
                            <span data-bind="text: quantity"></span> <span data-bind="text: optionName"></span>; 
                            <!-- /ko -->
                            <!-- /ko -->
                        </td>
                    </tr>
	            </tfoot>
            </table>
        </div>
        <!-- ko foreach: placeSummaries -->
        <div class="tab-pane" data-bind="attr: { id: 'tab' + placeKey}">
            <h4>Pedido <span data-bind="text: placeName"></span></h4>
            <table class="table table-striped table-bordered table-hover table-condensed">
                <thead>
                    <tr>
                        <th>Menú</th>
                        <th>Comida</th>
                        <th>Cantidad</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: optionSummaries">
                    <tr>
                        <td data-bind="text: optionName"></td>
                        <td data-bind="text: food"></td>
                        <td data-bind="text: quantity"></td>
                    </tr>
                </tbody>
            </table>
            <hr />
            <table class="table table-striped table-bordered table-hover table-condensed table-detail">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Menú</th>
                        <th>Comida</th>
                        <th>Comentario</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: $root.detail">
                    <!-- ko if: placeKey == $parent.placeKey && optionKey -->
                    <tr>
                        <td>
                            <!--
                            @using (var helper = Html.GetSecurityTrimmingHelper("Edit"))
                            {
                                if (helper.HasPermission) {
                                    <a data-bind="text: employeeName, attr: { href: url, title: 'Editar menú de ' + employeeName }"></a>
                                } else {
                                    <span data-bind="text: employeeName"></span>
                                }
                            }
                            -->
                        </td>
                        <td data-bind="text: optionName"></td>
                        <td data-bind="text: food"></td>
                        <td data-bind="text: comment"></td>
                    </tr>
                    <!-- /ko -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4">
                            <strong data-bind="text: placeName"></strong> <span data-bind="text: $root.orderDate.format('dddd, D [de] MMMM YYYY')"></span>:
                            <!-- ko foreach: optionSummaries -->
                            <!-- ko if: quantity -->
                            <span data-bind="text: quantity"></span> <span data-bind="text: optionName"></span>; 
                            <!-- /ko -->
                            <!-- /ko -->
                        </td>
                    </tr>
	            </tfoot>
            </table>

        </div>
        <!-- /ko -->
    </div>

</div>


